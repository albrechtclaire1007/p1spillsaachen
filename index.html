<script>
/* ---------- AUDIO ROOT ---------- */
const AUDIO = "https://github.com/albrechtclaire1007/p1schoulsaachen/raw/refs/heads/main";

/* ---------- ITEMS (4 updated audio names) ---------- */
const ITEMS = [
  { id:'blaisteft', word:'e Bläisteft',
    img:'https://i.postimg.cc/5YJ7PXCx/blaisteft.png',
    audio:`${AUDIO}/P1_bläistëft.mp3`, cat:'schachtel' },

  { id:'blaisteftsfaarwen', word:'Bläistëftsfaarwen',
    img:'https://i.postimg.cc/rdxZC1K8/blaisteftsfaarwen.png',
    audio:`${AUDIO}/M__M__blaischteftsfaarf.mp3`, cat:'schachtel' },

  { id:'buch', word:'e Buch',
    img:'https://i.postimg.cc/R6msPWHv/buch.png',
    audio:`${AUDIO}/Buch.mp3`, cat:'schoulsak' },

  { id:'classeur', word:'e Classeur',
    img:'https://i.postimg.cc/5HLKqB6d/classeur.png',
    audio:`${AUDIO}/Classeur.mp3`, cat:'klassesall' },

  { id:'gummi', word:'e Gummi',
    img:'https://i.postimg.cc/gXpSMxZd/gummi.png',
    audio:`${AUDIO}/Gummi.mp3`, cat:'schachtel' },

  { id:'heft', word:'e Heft',
    img:'https://i.postimg.cc/NymC765s/heft.png',
    audio:`${AUDIO}/P1_Heft.mp3`, cat:'schoulsak' },

  { id:'joffer', word:'eng Joffer',
    img:'https://i.postimg.cc/SnwtMTQt/joffer.png',
    audio:`${AUDIO}/Joffer.mp3`, cat:'klassesall' },

  { id:'lineal', word:'e Lineal',
    img:'https://i.postimg.cc/r0TnhDrT/lineal.png',
    audio:`${AUDIO}/Lineal.mp3`, cat:'schachtel' },

  { id:'pech', word:'e Pech',
    img:'https://i.postimg.cc/1nSCW8qq/pech.png',
    audio:`${AUDIO}/Pech.mp3`, cat:'schachtel' },

  { id:'schachtel', word:'eng Schachtel',
    img:'https://i.postimg.cc/rDvYrnyn/schachtel.png',
    audio:`${AUDIO}/Schachtel.mp3`, cat:'schoulsak' },

  { id:'scheier', word:'eng Schéier',
    img:'https://i.postimg.cc/ZBm7fWdN/scheier.png',
    audio:`${AUDIO}/M__SCHEIER.wav`, cat:'schachtel' },

  { id:'schoulsak', word:'e Schoulsak',
    img:'https://i.postimg.cc/cKwkMR65/schoulsak.png',
    audio:`${AUDIO}/Schoulsak.mp3`, cat:'schoulsak' },

  { id:'schwamp', word:'e Schwamp',
    img:'https://i.postimg.cc/9D4nz5hs/schwamp.png',
    audio:`${AUDIO}/Schwamp.mp3`, cat:'klassesall' },

  { id:'spetzer', word:'e Spëtzer',
    img:'https://i.postimg.cc/BjdwKYZV/spetzer.png',
    audio:`${AUDIO}/P1_Spëtzer.mp3`, cat:'schachtel' },

  { id:'tafel', word:'eng Tafel',
    img:'https://i.postimg.cc/VJ3HCGsT/tafel.png',
    audio:`${AUDIO}/Tafel.mp3`, cat:'klassesall' },

  { id:'tuschfaarwen', word:'Tuschfaarwen',
    img:'https://i.postimg.cc/McV3b7vp/tuschfaarwen.png',
    audio:`${AUDIO}/P1_tuschfaarwen.mp3`, cat:'schachtel' }
];

/* ---------- UTIL ---------- */
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }

const pages = ["g1","g2","g3","g4","g5"];
let pageIdx = 0;

const prevBtn=document.getElementById('prev');
const nextBtn=document.getElementById('next');
const flowLabel=document.getElementById('flowLabel');

function updateNav(){
  flowLabel.textContent = `${pageIdx+1}. Spill`;
  prevBtn.classList.toggle('hidden', pageIdx===0);
  nextBtn.classList.toggle('hidden', pageIdx===pages.length-1);
}
function showPage(i){
  pageIdx = Math.max(0,Math.min(i,pages.length-1));
  pages.forEach((id,idx)=>document.getElementById(id).classList.toggle('hidden',idx!==pageIdx));
  updateNav();
}
prevBtn.onclick = ()=>showPage(pageIdx-1);
nextBtn.onclick = ()=>showPage(pageIdx+1);

function autoAdvance(delay=900){
  setTimeout(()=>{
    if(pageIdx < pages.length-1) showPage(pageIdx+1);
  },delay);
}

const speaker=document.getElementById('speaker');
function playSound(src){ try{ speaker.src=src; speaker.play(); }catch(e){} }

function flash(el, ok){
  el.classList.remove('flash-good','flash-bad'); void el.offsetWidth;
  el.classList.add(ok?'flash-good':'flash-bad');
  setTimeout(()=>el.classList.remove('flash-good','flash-bad'),300);
}

/* ---------- GAME 1 ---------- */
const grid1=document.getElementById('grid1');
const play1=document.getElementById('play1');
let bag1=[], target1=null;

function layoutG1(){
  grid1.innerHTML="";
  ITEMS.forEach(it=>{
    const b=document.createElement('button');
    b.className='imgToken';
    const img=document.createElement('img'); img.src=it.img;
    b.appendChild(img);
    b.onclick=()=>checkG1(it,b);
    grid1.appendChild(b);
  });
}
function nextG1(){
  if(bag1.length===0){ autoAdvance(); return; }
  target1=bag1.pop();
  playSound(target1.audio);
}
function checkG1(it,btn){
  const ok = (it.id===target1.id);
  flash(btn,ok);
  if(ok) setTimeout(nextG1,300);
}
play1.onclick=()=>{ if(target1) playSound(target1.audio); };

/* ---------- GAME 2: MEMORY ---------- */
const memGrid=document.getElementById('memGrid');
const memReset=document.getElementById('memReset');

const MEM_IDS=['blaisteft','gummi','schwamp','schoulsak','schachtel','spetzer','tuschfaarwen','tafel'];
const MEM_ITEMS=ITEMS.filter(it=>MEM_IDS.includes(it.id));

let lockMem=false,firstPick=null,solved=0;

function buildMemory(){
  memGrid.innerHTML="";
  lockMem=false; firstPick=null; solved=0;

  const cards=[];
  MEM_ITEMS.forEach(it=>{
    cards.push({type:'img',it}); cards.push({type:'snd',it});
  });
  shuffle(cards);

  cards.forEach(card=>{
    const el=document.createElement('div');
    el.className='card';
    el.innerHTML=`
      <div class="inner">
        <div class="face front"></div>
        <div class="face back">
          ${card.type==='img'
            ? `<img src="${card.it.img}" style="width:85%;height:85%;">`
            : `<div class="sndWord">${card.it.word}</div>`}
        </div>
      </div>
    `;
    el.dataset.key=card.it.id;
    el.dataset.type=card.type;
    el.onclick=()=>flipMem(el,card);
    memGrid.appendChild(el);
  });
}

function flipMem(el, card){
  if(lockMem) return;
  if(el.classList.contains('flipped')) return;

  el.classList.add('flipped');
  if(card.type==='snd') playSound(card.it.audio);

  if(!firstPick){ firstPick=el; return; }

  const match = (firstPick.dataset.key===el.dataset.key &&
                 firstPick!==el &&
                 firstPick.dataset.type!==el.dataset.type);

  lockMem=true;
  setTimeout(()=>{
    if(match){
      firstPick.style.pointerEvents='none';
      el.style.pointerEvents='none';
      solved++;
      if(solved===MEM_ITEMS.length) autoAdvance(700);
    } else {
      firstPick.classList.remove('flipped');
      el.classList.remove('flipped');
    }
    firstPick=null; lockMem=false;
  },650);
}

memReset.onclick=buildMemory;

/* ---------- GAME 3 ---------- */
const bigSq=document.getElementById('bigSq');
const bigImg=document.getElementById('bigImg');
const bigReset=document.getElementById('bigReset');
const sayPlay=document.getElementById('sayPlay');

let bag3=[];

function refill3(){ bag3=shuffle([...ITEMS]); }
function next3(){
  if(bag3.length===0){ autoAdvance(); return; }
  const it=bag3.pop();
  bigImg.src=it.img; bigImg.alt=it.word;
  bigSq.dataset.current=it.id;
}
bigSq.onclick=(e)=>{
  if(e.target===bigReset) return;
  next3();
};
bigReset.onclick=()=>{ refill3(); next3(); };
sayPlay.onclick=()=>{
  const it=ITEMS.find(x=>x.id===bigSq.dataset.current);
  if(it) playSound(it.audio);
};

/* ---------- GAME 4 ---------- */
const nounSq=document.getElementById('nounSq');
const nounImg=document.getElementById('nounImg');
let bag4=[],currentNoun=null;

function refill4(){ bag4=shuffle([...ITEMS]); }
function showNextNoun(){
  if(bag4.length===0){ autoAdvance(); return; }
  currentNoun=bag4.pop();
  nounImg.src=currentNoun.img;
}

nounSq.onclick=()=>{
  if(!currentNoun){ showNextNoun(); return; }
  playSound(currentNoun.audio);
  setTimeout(showNextNoun,900);
};

/* ---------- GAME 5: SORTING ---------- */
const sortPool=document.getElementById('sortPool');
const dropCols=document.querySelectorAll('.dropCol');
let sortedCount=0;
let selectedItem=null;
let draggedItem=null;

function buildSortGame(){
  sortedCount=0; selectedItem=null; draggedItem=null;
  sortPool.innerHTML="";
  dropCols.forEach(col=>col.querySelector('.dropInner').innerHTML="");

  const pool=shuffle([...ITEMS]);
  pool.forEach(it=>{
    const btn=document.createElement('button');
    btn.className='sortItem';
    btn.dataset.id=it.id;
    btn.draggable=true;
    btn.innerHTML=`<img src="${it.img}">`;

    btn.onclick=()=>{
      if(btn.classList.contains('placed')) return;
      if(selectedItem===btn){
        btn.classList.remove('selected');
        selectedItem=null;
      }else{
        if(selectedItem) selectedItem.classList.remove('selected');
        selectedItem=btn;
        btn.classList.add('selected');
      }
    };

    btn.ondragstart=()=>{
      draggedItem=btn;
      if(selectedItem && selectedItem!==btn) selectedItem.classList.remove('selected');
      selectedItem=btn; btn.classList.add('selected');
    };
    btn.ondragend=()=>{ draggedItem=null; };

    sortPool.appendChild(btn);
  });
}

dropCols.forEach(col=>{
  const cat=col.dataset.cat;
  const inner=col.querySelector('.dropInner');

  col.ondragover=(e)=>{
    if(draggedItem) e.preventDefault();
  };
  col.ondrop=(e)=>{
    e.preventDefault();
    if(draggedItem) handlePlace(draggedItem,cat,inner,col);
  };

  col.onclick=()=>{
    if(selectedItem && !selectedItem.classList.contains('placed'))
      handlePlace(selectedItem,cat,inner,col);
  };
});

function handlePlace(btn,cat,inner,col){
  const it=ITEMS.find(x=>x.id===btn.dataset.id);
  const ok=(it.cat===cat);
  flash(col,ok);
  if(ok){
    btn.classList.add('placed');
    btn.classList.remove('selected');
    btn.draggable=false;
    btn.style.pointerEvents='none';
    inner.appendChild(btn);
    sortedCount++;
    selectedItem=null;
    if(sortedCount===ITEMS.length){
      document.getElementById('endBanner').style.display='flex';
      setTimeout(()=>document.getElementById('endBanner').style.display='none',1600);
    }
  } else flash(btn,false);
}

/* ---------- INIT ---------- */
function init(){
  layoutG1(); bag1=shuffle([...ITEMS]); nextG1();
  buildMemory();
  refill3(); next3();
  refill4(); 
  buildSortGame();
  showPage(0);
}
init();
</script>
</body>
</html>


