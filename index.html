<!DOCTYPE html>
<html lang="lb">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>P1 â€“ Spillsaachen â€“ Spiller</title>
<style>
  /* Font */
  @font-face{
    font-family:'SchoulschrÃ«ft';
    src:url('https://raw.githubusercontent.com/albrechtclaire1007/schoulschreft/main/schoulschreft_bold%5B2%5D.TTF') format('truetype');
    font-weight:bold; font-style:normal; font-display:swap;
  }

  :root{
    /* P1 pinks */
    --pink-mid:#e4b7d0;
    --pink-light:#f6e4ee;
    --pink-dark:#d88cb8;
    --ink:#1f1f1f;
    --white:#fff;
    --bad:#ffcccc;
    --ok:#b7f0c8;
    --border:3px;
  }

  *{box-sizing:border-box; -webkit-tap-highlight-color:transparent; user-select:none; outline:none;}
  html,body{height:100%; margin:0; background:linear-gradient(135deg,var(--pink-mid),var(--pink-light)); color:var(--ink); font-family:'SchoulschrÃ«ft', Arial, sans-serif;}

  .top{
    position:sticky; top:8px; z-index:10; display:flex; gap:10px; align-items:center; justify-content:center;
    background:var(--white); border:var(--border) solid var(--pink-dark); border-radius:18px;
    padding:.35rem .6rem; margin:10px auto; width:fit-content;
    box-shadow:0 8px 24px rgba(0,0,0,.08);
  }
  .btn{
    border:var(--border) solid var(--ink); background:var(--white); color:var(--ink);
    padding:.45rem .85rem; border-radius:14px; cursor:pointer; font-size:1.05rem;
  }
  .btn:active{ transform:scale(.98); }
  .flow{opacity:.9; font-size:1rem; padding:0 .4rem; min-width:10ch; text-align:center;}

  .wrap{
    min-height:100%;
    display:flex; flex-direction:column; align-items:center;
    gap:2.5vmin; padding:2.5vmin 3vmin 4vmin;
  }
  h1{margin:.2rem 0 0; text-align:center; font-size:clamp(2rem, 6vmin, 4.2rem); color:var(--ink);}

  .hidden{display:none !important;}

  /* Generic grids */
  .grid{
    width:95vw; max-width:2000px; display:grid; gap:2vmin;
    grid-template-columns: repeat(auto-fill, minmax(14vmin, 1fr));
    align-items:stretch;
  }

  /* Image tokens (square buttons) */
  .imgToken{
    background:var(--white); border:6px solid var(--pink-mid); border-radius:22px;
    display:grid; place-items:center; aspect-ratio:1/1; cursor:pointer;
    transition:transform .1s ease, border-color .15s ease, filter .15s ease, background .15s ease;
    box-shadow:0 10px 26px rgba(0,0,0,.08);
  }
  .imgToken:active{ transform:scale(.97); }
  .imgToken img{ width:90%; height:90%; object-fit:contain; }

  .flash-good{ background:var(--ok) !important; border-color:var(--ok) !important; }
  .flash-bad{ background:var(--bad) !important; border-color:var(--bad) !important; }

  /* Audio play button */
  .audioBar{ display:flex; align-items:center; gap:.8rem; }
  .playBtn{
    width:58px; height:58px; border-radius:50%;
    border:var(--border) solid var(--ink); background:var(--pink-mid);
    display:grid; place-items:center; font-size:1.3rem; cursor:pointer;
  }

  /* Big random square (game 3) */
  .bigSquare{
    width:min(95vmin,100%); aspect-ratio:1/1; background:#fff;
    border:12px solid var(--pink-mid); border-radius:40px; display:grid; place-items:center;
    position:relative; cursor:pointer;
    box-shadow:0 10px 30px rgba(0,0,0,.08);
    transition:transform .12s ease;
  }
  .bigSquare:active{ transform:scale(.98); }
  .bigSquare img{ width:88%; height:88%; object-fit:contain; }
  .reset{
    position:absolute; top:14px; right:18px; width:48px; height:48px; border-radius:50%;
    background:#fff; border:4px solid var(--pink-mid); display:grid; place-items:center;
    font-size:1.4rem; line-height:1; cursor:pointer;
  }
  .fade{ animation:fadeIn .35s ease; }
  @keyframes fadeIn{ from{opacity:0; transform:scale(.9)} to{opacity:1; transform:scale(1)} }

  /* Memory */
  .memGrid{
    width:95vw; max-width:1600px;
    display:grid; gap:1.4vmin;
    grid-template-columns: repeat(auto-fill, minmax(16vmin, 1fr));
  }
  .card{
    aspect-ratio:3/4; perspective:1000px; cursor:pointer;
  }
  .inner{
    position:relative; width:100%; height:100%;
    transform-style:preserve-3d; transition:transform .25s ease;
  }
  .flipped .inner{ transform:rotateY(180deg); }
  .face{
    position:absolute; inset:0; border-radius:18px; border:6px solid var(--pink-mid);
    backface-visibility:hidden; display:grid; place-items:center; background:#fff;
    box-shadow:0 8px 20px rgba(0,0,0,.08);
  }
  .front{ }
  .back{ transform:rotateY(180deg); }
  .soundTag{ font-size:clamp(1.4rem,4vmin,2.2rem); }

  /* Sentence builder (game 4) */
  .sentence{ display:flex; align-items:center; gap:min(2.2vmin,16px); flex-wrap:wrap; justify-content:center; font-size:clamp(2rem,4.8vw,3.2rem); }
  .inlineSq{
    display:inline-grid; place-items:center; width:min(36vmin,420px); aspect-ratio:1/1;
    border:10px solid var(--pink-mid); border-radius:28px; background:#fff; cursor:pointer;
    box-shadow:0 8px 24px rgba(0,0,0,.08); font-size:min(20vmin,10rem); transition:transform .12s ease;
  }
  .inlineSq:active{ transform:scale(.97); }
  .wordSq{ padding:0 .6rem; min-height:3.2rem; border-radius:16px; border:6px solid var(--pink-mid); background:#fff; }
  .wordSqBtn{ border:6px solid var(--pink-mid); background:var(--pink-light); padding:.3rem .7rem; border-radius:14px; cursor:pointer; }
  .miniBar{ display:flex; gap:.6rem; align-items:center; justify-content:center; flex-wrap:wrap; }
  .hint{ font-size:clamp(1.1rem,2.6vw,1.6rem); opacity:.8; }

</style>
</head>
<body>

<!-- Top nav -->
<div class="top">
  <button class="btn" id="prev">ZrÃ©ck</button>
  <span class="flow" id="flowLabel">1. Spill</span>
  <button class="btn" id="next">Weider</button>
</div>

<!-- Spill 1: Lauschter a klick op dat richtegt Bild -->
<section class="wrap" id="g1">
  <h1>Lauschter a klick op dat richtegt Bild</h1>
  <div class="audioBar"><button class="playBtn" id="play1" title="Ofspillen">â–¶</button></div>
  <div class="grid" id="grid1"></div>
</section>

<!-- Spill 2: Memory (Bild â€“ Toun) -->
<section class="wrap hidden" id="g2">
  <h1>Memory: Bild â€“ Toun</h1>
  <div class="memGrid" id="memGrid"></div>
  <div class="miniBar">
    <button class="btn" id="memReset">Nei mÃ«schen</button>
  </div>
</section>

<!-- Spill 3: Kuck a so wat et ass -->
<section class="wrap hidden" id="g3">
  <h1>Kuck a so wat et ass</h1>
  <div class="bigSquare" id="bigSq">
    <img id="bigImg" alt="">
    <button class="reset" id="bigReset" title="Nei ufÃ¤nken">â†»</button>
  </div>
  <div class="miniBar">
    <button class="btn" id="sayPlay">Toun spillen</button>
  </div>
</section>

<!-- Spill 4: Lies d'SÃ¤tz -->
<section class="wrap hidden" id="g4">
  <h1>Lies d'SÃ¤tz</h1>
  <div class="sentence">
    <span>Ech</span>
    <span class="wordSq">spille</span>
    <span class="wordSq">gÃ¤r</span>
    <button class="wordSqBtn" id="prepSq" title="mam / mat der">mam</button>
    <div class="inlineSq" id="nounSq"><img id="nounImg" alt="" style="width:85%; height:85%; object-fit:contain"></div>
    <span>.</span>
  </div>
  <div class="miniBar">
    <button class="btn" id="playSentence">Saz ofspillen</button>
    <button class="btn" id="nextNoun">NÃ¤chst</button>
    <span class="hint">Hinweis: **mat der** nÃ«mme bei <em>eng Popp</em> a <em>eng Trommel</em>.</span>
  </div>
</section>

<audio id="speaker" preload="auto"></audio>

<script>
/* ---------- DATA ---------- */
const RAW = "https://raw.githubusercontent.com/albrechtclaire1007/p1spillsaachen/main";

/* Items reused from your existing P1 quiz (ids, words, imgs, audios)
   + preposition rule for game 4: Popp & Trommel -> 'mat der', others -> 'mam' */
const ITEMS = [
  { id:'teddybier',  word:'en Teddybier',  img:'https://i.postimg.cc/XpDBC4jQ/1.png',  audio:`${RAW}/teddybier1.mp3`,  prep:'mam' },
  { id:'fliger',     word:'e Fliger',      img:'https://i.postimg.cc/zHG3yP4s/2.png',  audio:`${RAW}/1fliger.mp3`,     prep:'mam' },
  { id:'velo',       word:'e VÃ«lo',        img:'https://i.postimg.cc/qztMWnrx/11.png', audio:`${RAW}/1velo.mp3`,       prep:'mam' },
  { id:'popp',       word:'eng Popp',      img:'https://i.postimg.cc/KkJ8hD4J/8.png',  audio:`${RAW}/1popp.mp3`,       prep:'matder' },
  { id:'ball',       word:'e Ball',        img:'https://i.postimg.cc/Vd5d1pqM/5.png',  audio:`${RAW}/1ball.mp3`,       prep:'mam' },
  { id:'wierfel',    word:'e Wierfel',     img:'https://i.postimg.cc/YhJq79qK/12.png', audio:`${RAW}/1wierfel.mp3`,    prep:'mam' },
  { id:'roboter',    word:'e Roboter',     img:'https://i.postimg.cc/BtSj7Xtm/3.png',  audio:`${RAW}/1roboter.mp3`,    prep:'mam' },
  { id:'radio',      word:'e Radio',       img:'https://i.postimg.cc/WdkzqZf1/6.png',  audio:`${RAW}/1radio.mp3`,      prep:'mam' },
  { id:'kaartespill',word:'e Kaartespill', img:'https://i.postimg.cc/YGpCPs2v/9.png',  audio:`${RAW}/1kaarte.mp3`,     prep:'mam' },
  { id:'trommel',    word:'eng Trommel',   img:'https://i.postimg.cc/xq1dyhF7/10.png', audio:`${RAW}/1trommel.mp3`,    prep:'matder' },
  { id:'videospill', word:'e Videospill',  img:'https://i.postimg.cc/S2rJNp1L/4.png',  audio:`${RAW}/1video.mp3`,      prep:'mam' },
  { id:'pesel',      word:'e PÃ«sel',       img:'https://i.postimg.cc/SXbs6Kw7/7.png',  audio:`${RAW}/1pesel.mp3`,      prep:'mam' }
];

/* Sentence word audios */
const SAZ = {
  ech    : `${RAW}/ech.mp3`,
  spillen: `${RAW}/spillen.mp3`,
  gaar   : `${RAW}/gÃ¤r.mp3`,
  mam    : `${RAW}/mam.mp3`,
  matder : `${RAW}/mat%20der.mp3`
};

/* ---------- UTIL ---------- */
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]];} return a; }
const pages = ["g1","g2","g3","g4"];
let pageIdx = 0;
const flowLabel = document.getElementById('flowLabel');
function labelFor(i){ return `${i+1}. Spill`; }
function showPage(i){
  pageIdx = Math.max(0, Math.min(pages.length-1, i));
  pages.forEach((id,idx)=>document.getElementById(id).classList.toggle('hidden', idx!==pageIdx));
  flowLabel.textContent = labelFor(pageIdx);
}
document.getElementById('prev').onclick = ()=> showPage(pageIdx-1);
document.getElementById('next').onclick = ()=> showPage(pageIdx+1);

const speaker = document.getElementById('speaker');
async function playSound(src){ try{ if(speaker.src!==src) speaker.src=src; await speaker.play(); }catch(e){} }
function flash(el, ok){
  el.classList.remove('flash-good','flash-bad');
  void el.offsetWidth;
  el.classList.add(ok ? 'flash-good' : 'flash-bad');
  setTimeout(()=> el.classList.remove('flash-good','flash-bad'), 260);
}

/* ---------- SPILL 1: Listen & click correct image ---------- */
const grid1 = document.getElementById('grid1');
const play1 = document.getElementById('play1');
let bag1 = shuffle([...ITEMS]);
let target1 = null;

function layoutG1(){
  grid1.innerHTML = "";
  const pool = shuffle([...ITEMS]);
  pool.forEach(it=>{
    const b = document.createElement('button');
    b.className = 'imgToken';
    const img = document.createElement('img');
    img.src = it.img; img.alt = it.word;
    b.appendChild(img);
    b.onclick = ()=> checkG1(it, b);
    grid1.appendChild(b);
  });
}
function nextG1(){
  if(bag1.length===0) bag1 = shuffle([...ITEMS]);
  target1 = bag1.pop();
  playSound(target1.audio); // autoplay
}
function checkG1(it, el){
  const ok = (it.id === target1.id);
  flash(el, ok);
  if(ok){ setTimeout(nextG1, 280); }
}
play1.onclick = ()=> { if(target1) playSound(target1.audio); };

/* ---------- SPILL 2: Memory (image â€“ sound) ---------- */
const memGrid = document.getElementById('memGrid');
const memReset = document.getElementById('memReset');
let lockMem = false; let firstPick = null; let solved = 0;

function buildMemory(){
  memGrid.innerHTML = ""; lockMem = false; firstPick = null; solved = 0;
  // Build pairs: for each item, one image card + one sound card
  const cards = [];
  ITEMS.forEach((it,idx)=>{
    cards.push({type:'img', key:it.id, it});
    cards.push({type:'snd', key:it.id, it});
  });
  shuffle(cards).forEach((card, i)=>{
    const el = document.createElement('div');
    el.className = 'card';
    el.dataset.key = card.key;
    el.dataset.type = card.type;
    el.innerHTML = `
      <div class="inner">
        <div class="face front" style="background:#fff; border-color:var(--pink-mid)"></div>
        <div class="face back">
          ${card.type==='img' ? `<img src="${card.it.img}" alt="${card.it.word}" style="width:85%; height:85%; object-fit:contain">`
                               : `<div class="soundTag">ðŸ”Š ${card.it.word}</div>`}
        </div>
      </div>`;
    el.addEventListener('click', ()=> flipMem(el, card));
    memGrid.appendChild(el);
  });
}
function flipMem(el, card){
  if(lockMem) return;
  const already = el.classList.contains('flipped');
  if(already) return;

  el.classList.add('flipped');
  if(card.type==='snd'){ playSound(card.it.audio); }

  if(!firstPick){ firstPick = el; return; }

  // Check match
  const match = (firstPick.dataset.key === el.dataset.key) && (firstPick !== el)
               && (firstPick.dataset.type !== el.dataset.type);
  lockMem = true;
  setTimeout(()=>{
    if(match){
      // Keep them flipped & remove pointer events
      firstPick.style.pointerEvents = 'none';
      el.style.pointerEvents = 'none';
      solved += 1;
    }else{
      firstPick.classList.remove('flipped');
      el.classList.remove('flipped');
    }
    firstPick = null; lockMem = false;
  }, 650);
}
memReset.onclick = buildMemory;

/* ---------- SPILL 3: Random big square ---------- */
const bigSq = document.getElementById('bigSq');
const bigImg = document.getElementById('bigImg');
const bigReset = document.getElementById('bigReset');
const sayPlay = document.getElementById('sayPlay');
let bag3 = [];
function refill3(){ bag3 = shuffle([...ITEMS]); }
function next3(){
  if(bag3.length===0) refill3();
  const it = bag3.pop();
  bigImg.src = it.img; bigImg.alt = it.word;
  bigImg.classList.remove('fade'); void bigImg.offsetWidth; bigImg.classList.add('fade');
  playSound(it.audio);
  bigSq.dataset.current = it.id;
}
function reset3(){ refill3(); bigImg.src=''; bigImg.alt=''; bigSq.dataset.current=''; }
bigSq.addEventListener('click', (e)=>{ if(e.target===bigReset) return; next3(); });
bigReset.addEventListener('click', (e)=>{ e.stopPropagation(); reset3(); });
sayPlay.addEventListener('click', ()=>{
  const it = ITEMS.find(x=>x.id===bigSq.dataset.current);
  if(it) playSound(it.audio);
});

/* ---------- SPILL 4: Sentences (mam / mat der) ---------- */
const nounSq = document.getElementById('nounSq');
const nounImg = document.getElementById('nounImg');
const prepSq = document.getElementById('prepSq');
const nextNounBtn = document.getElementById('nextNoun');
const playSentenceBtn = document.getElementById('playSentence');

let bag4 = []; let currentNoun = null;
function refill4(){ bag4 = shuffle([...ITEMS]); }
function setNoun(it){
  currentNoun = it;
  nounImg.src = it.img; nounImg.alt = it.word;
  nounImg.classList.remove('fade'); void nounImg.offsetWidth; nounImg.classList.add('fade');
  // default prep on noun change: mam
  prepSq.textContent = 'mam';
}
function nextNoun(){
  if(bag4.length===0) refill4();
  setNoun(bag4.pop());
}
function togglePrep(){
  const now = prepSq.textContent.trim();
  prepSq.textContent = (now==='mam') ? 'mat der' : 'mam';
  // play matching prep audio
  playSound(now==='mam' ? SAZ.matder : SAZ.mam);
  // feedback if correct for this noun
  const correct = (currentNoun?.prep === (prepSq.textContent==='mat der' ? 'matder' : 'mam'));
  flash(prepSq, correct);
}
prepSq.addEventListener('click', togglePrep);
nextNounBtn.addEventListener('click', nextNoun);

async function playSentence(){
  // Ech â€“ spille â€“ gÃ¤r â€“ (mam/mat der) â€“ <word>
  // We play 4 audios in sequence, then the noun audio
  const queue = [SAZ.ech, SAZ.spillen, SAZ.gaar, (prepSq.textContent==='mat der' ? SAZ.matder : SAZ.mam), currentNoun?.audio];
  for(const src of queue){
    if(!src) continue;
    await new Promise(res=>{
      speaker.onended = ()=> res();
      playSound(src).then(()=>{}).catch(()=>res());
      // small guard timeout in case autoplay fails silently
      setTimeout(()=>res(), 2500);
    });
  }
}
playSentenceBtn.addEventListener('click', playSentence);

/* ---------- INIT ---------- */
function init(){
  // g1
  layoutG1(); nextG1();
  // g2
  buildMemory();
  // g3
  reset3();
  // g4
  refill4(); nextNoun();
  // start
  showPage(0);
}
init();
</script>
</body>
</html>
